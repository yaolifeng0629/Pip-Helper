## 功能需求

Chrome的原生画中画（Picture-in-Picture, PiP）API，结合对主流视频平台的适配，可以打造一款非常实用的插件。

为了实现你描述的功能并提供出色的用户体验，以下是我觉得应该包含的功能点：

---

### **核心功能 (Must-Have)**

1.  **一键画中画激活：**
    *   **工具栏图标点击：** 当当前页面有可画中画的视频时，插件图标应高亮，点击即可将当前播放的视频切换到画中画模式。
    *   **右键上下文菜单：** 在视频元素上右键，提供“画中画播放”选项。这是处理页面上多个视频时的最佳方式。
    *   **键盘快捷键：** 提供可自定义的全局快捷键（例如：`Alt + P` 或 `Ctrl + Shift + P`），快速激活画中画。

2.  **主流视频平台兼容性：**
    *   **基础 HTML5 `<video>` 标签支持：** 确保所有标准HTML5视频都能正常画中画。
    *   **特定平台深度适配：**
        *   **YouTube：** 应对其复杂的播放器UI和广告逻辑。
        *   **Netflix：** 考虑其特有的全屏模式和视频加载方式。
        *   **Bilibili：** 适配其弹幕和播放器控制。
        *   **腾讯视频、爱奇艺、优酷：** 国内主流平台，需要针对性适配。
        *   **Vimeo, Twitch, Disney+等：** 尽可能覆盖更多国际平台。
    *   **Iframe 嵌入视频支持：** 能够识别并操作被嵌入到 iframe 中的视频（例如，网页中嵌入的YouTube视频）。

3.  **画中画窗口持续性：**
    *   **浏览器最小化后依然保留：** 这是你提到的核心需求，利用Chrome的原生PiP API实现，确保PiP窗口是系统级的，不依附于浏览器窗口本身。
    *   **切换标签页/窗口不中断：** 即使切换到其他标签页或浏览器窗口，PiP视频也能继续播放。

4.  **基础画中画窗口控制：**
    *   **播放/暂停：** PiP窗口自带的播放/暂停按钮。
    *   **返回原始标签页：** PiP窗口应提供一个按钮，点击后能快速回到视频所在的原始标签页（并自动聚焦）。
    *   **静音/取消静音：** PiP窗口自带的音量控制。

---

### **用户体验与便捷性 (Good-to-Have)**

5.  **智能识别与提示：**
    *   **可画中画视频识别：** 当用户访问包含视频的页面时，插件图标应有视觉反馈（如变色、加角标），提示当前页面有视频可进行画中画。
    *   **多视频选择：** 如果页面上有多个视频，插件应能智能选择正在播放的视频，或者在点击工具栏图标时弹出一个小浮窗，列出所有视频供用户选择。

6.  **自定义设置与偏好：**
    *   **黑/白名单网站：** 用户可以设置某些网站默认禁用或启用画中画功能。
    *   **默认画中画行为：** 例如，是否在新视频加载时自动进入画中画模式（谨慎开启，可能打扰用户）。
    *   **快捷键自定义：** 允许用户修改默认的快捷键。

7.  **播放进度与状态同步：**
    *   画中画窗口中的播放进度、音量、播放速度等应与原视频播放器同步。
    *   当返回原始标签页时，原视频播放器应保持画中画时的状态。

8.  **错误处理与用户反馈：**
    *   当无法激活画中画时，能给出友好的提示（例如：”当前视频不支持画中画“或”请先播放视频再尝试“）。
    *   清晰的加载/激活状态提示。

---

### **高级功能与定制 (Nice-to-Have)**

11. **多画中画窗口 (非常高级/复杂)：** 理论上Chrome原生PiP一次只能一个，但如果能实现多个浮动视频窗口，那将是杀手级功能（可能需要脱离原生PiP API，自己实现一个自定义的浮动窗口，但这样就无法在浏览器最小化后保留）。对于你当前的需求，建议优先使用原生PiP，一次一个。
12. **PiP窗口大小/位置记忆：** 记住上次画中画窗口的大小和屏幕位置。
13. **高级平台适配：** 比如支持直播流的画中画（Twitch, YouTube Live等）。

---

### **技术实现考量 (Developer's Note)**

*   **Manifest V3：** 确保插件符合Chrome的Manifest V3规范。
*   **权限管理：** 需要`pictureInPicture`、`activeTab`、`scripting`（用于注入内容脚本）和`storage`（用于保存用户设置）等权限。
*   **内容脚本 (Content Scripts)：** 这是插件与网页上视频元素交互的关键。需要监听视频元素的`play`、`pause`、`ended`等事件，并找到正确的`<video>`元素来激活PiP。
*   **后台服务工作者 (Service Worker / Background Script)：** 负责处理来自工具栏图标、快捷键的命令，并与内容脚本进行通信。
*   **DOM 结构分析：** 不同视频平台的播放器DOM结构差异巨大，这是适配的最大挑战。可能需要使用`MutationObserver`来监听DOM变化，以及针对不同平台编写特定的选择器和逻辑。
*   **长期维护：** 视频平台会不断更新其播放器，这意味着你的插件需要定期更新以保持兼容性。

---

### **总结**

你的核心需求是“**当最小化浏览器后也能正常保留在画中画中**”，这正是Chrome原生画中画API的强项。在此基础上，着重提升**主流平台的兼容性**和**用户操作的便捷性**（一键激活、快捷键、返回原标签页）将是成功的关键。


## 框架
1. Vue3
2. TypeScript
3. Vite
4. https://github.com/sampotts/plyr
